{% set nextReads = entry.projectNextReads.eagerly().all() %}

{% if not nextReads|length %}
  {% set topic = entry.projectTopics.one() %}
  {% set technology = entry.projectTechnologies.one() %}
  
  {% set baseQuery = craft.entries.section('projects')
    .id('not ' ~ entry.id)
    .with([
      'projectYearGroups',
      'projectRounds',
      'projectTopics',
      'projectTechnologies'
    ])
    .limit(4)
  %}

  {% if topic and technology %}
    {% set nextReads = baseQuery.relatedTo(['and', 
      { targetElement: topic }, 
      { targetElement: technology }
    ]).all() %}
    
    {% if not nextReads|length %}
      {% set nextReads = baseQuery.relatedTo({ targetElement: topic }).all() %}
    {% endif %}
  {% elseif topic %}
    {% set nextReads = baseQuery.relatedTo({ targetElement: topic }).all() %}
  {% endif %}
  
  {% if not nextReads|length %}
    {% set nextReads = baseQuery.all() %}
  {% endif %}
{% endif %}

{% if nextReads|length %}
  {% set content %}
    {% include "projects/_modules/teasers-list" with { projects: nextReads } %}
  {% endset %}

  {% include "_modules/next-reads" with {
    heading: "More projects like this"|t,
    sideLink: {
      text: "See all"|t,
      url: projectsIndex.url
    },
    content: content,
  } only %}
{% endif %}